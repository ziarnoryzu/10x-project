---
import AuthLayout from "../layouts/AuthLayout.astro";
import { LoginForm } from "../components/auth/LoginForm";

export const prerender = false;

// Check if user is already logged in
// TODO: Implement requireNoAuth helper when auth middleware is ready
// const session = Astro.locals.session;
// if (session) {
//   return Astro.redirect("/app");
// }

// Get redirect parameter from URL
const redirectTo = Astro.url.searchParams.get("redirect") || "/app";

// Get success message from URL params
const successParam = Astro.url.searchParams.get("success");
let successMessage: string | null = null;

if (successParam === "password-reset") {
  successMessage = "Hasło zostało zmienione. Możesz się teraz zalogować.";
} else if (successParam === "registration") {
  successMessage = "Konto zostało utworzone. Zaloguj się, aby kontynuować.";
}

const title = "Logowanie - VibeTravels";
---

<AuthLayout title={title}>
  <LoginForm client:load redirectTo={redirectTo} successMessage={successMessage} />

  <div slot="footer">
    Nie masz konta?
    <a href="/register" class="font-medium text-primary hover:underline">Zarejestruj się</a>
  </div>
</AuthLayout>
