---
import AuthLayout from "../layouts/AuthLayout.astro";
import { ResetPasswordForm } from "../components/auth/ResetPasswordForm";

export const prerender = false;

// Check if user is already logged in
// TODO: Implement requireNoAuth helper when auth middleware is ready
// const session = Astro.locals.session;
// if (session) {
//   return Astro.redirect("/app");
// }

// Get the reset code from URL params
const code = Astro.url.searchParams.get("code");

// If no code provided, redirect to login
if (!code) {
  return Astro.redirect("/login?error=invalid-reset-link");
}

const title = "Ustaw nowe hasło - VibeTravels";
---

<AuthLayout title={title}>
  <ResetPasswordForm client:load code={code} />

  <div slot="footer">
    Pamiętasz hasło?
    <a href="/login" class="font-medium text-primary hover:underline">Zaloguj się</a>
  </div>
</AuthLayout>
